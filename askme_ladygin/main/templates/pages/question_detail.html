{% extends "base.html" %}
{% load static %}

{% block title %}{{ question.title }} — AskMe{% endblock %}

{% block content %}
  <!-- Хлебные крошки и заголовок -->
<div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-1">
          <li class="breadcrumb-item"><a href="{% url 'home' %}">Главная</a></li>
          <li class="breadcrumb-item"><a href="{% url 'home' %}">Вопросы</a></li>
          <li class="breadcrumb-item active" aria-current="page">{{ question.title }}</li>
        </ol>
      </nav>
      <h1 class="h4 mb-0">{{ question.title }}</h1>
    </div>
    <a href="{% url 'ask' %}" class="btn btn-primary">Задать вопрос</a>

</div>

<!-- Карточка вопроса -->
{% include "question.html" with q=question show_title=True %}

<div class="d-flex align-items-center justify-content-between mt-4 mb-2">
    <h2 class="h5 mb-0" id="answers">Ответы</h2>
    <span class="text-muted">{{ page_obj.paginator.count }} {{ page_obj.paginator.count|pluralize:"ответ,ответа,ответов" }}</span>
</div>

  <!-- Список ответов -->
{% for a in page_obj.object_list %}
    {% include "answer.html" with a=a %}
    {% empty %}
    <div class="text-muted">Ответов пока нет.</div>
{% endfor %}

<!-- Форма добавления ответа (только для авторизованных) -->
{% if user.is_authenticated %}
<div class="card mb-3">
  <div class="card-body">
    <h5 class="card-title mb-3">Ваш ответ</h5>
    
    <!-- Общие ошибки формы -->
    {% if form.non_field_errors %}
    <div class="alert alert-danger" role="alert">
      {{ form.non_field_errors }}
    </div>
    {% endif %}
    
    <form method="post" novalidate>
      {% csrf_token %}
      
      <div class="mb-3">
        <textarea 
          id="id_text" 
          name="text" 
          rows="6"
          class="form-control {% if form.text.errors %}is-invalid{% endif %}"
          placeholder="Напишите ваш ответ здесь..."
          required>{{ form.text.value|default:'' }}</textarea>
        {% if form.text.errors %}
        <div class="invalid-feedback">
            {% for error in form.text.errors %}
                {{ error }}
            {% endfor %}
        </div>
        {% endif %}
      </div>
      
      <button type="submit" class="btn btn-primary">Отправить ответ</button>
    </form>
  </div>
</div>
{% else %}
<!-- Сообщение для неавторизованных -->
<div class="card mb-3">
  <div class="card-body text-center">
    <p class="mb-2">Чтобы ответить на вопрос, необходимо <a href="{% url 'login' %}?continue={{ request.path }}">войти</a> или <a href="{% url 'signup' %}">зарегистрироваться</a>.</p>
  </div>
</div>
{% endif %}


<!-- Пагинация -->
{% include "paginator.html" with page_obj=page_obj %}
{% endblock %}
