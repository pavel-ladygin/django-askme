{% load static %}

<article class="card mb-3 answer {% if a.is_accepted %}accepted-answer{% endif %}" id="answer-{{ a.id }}">
  <div class="card-body d-flex gap-3">
    <!-- Левый блок: аватар + оценка + кнопка -->
    <div class="text-center" style="min-width: 120px; max-width: 120px;">
      <!-- Аватар -->
      {% if a.author.profile.avatar %}
        <img src="{{ a.author.profile.avatar.url }}" alt="Аватар" width="40" height="40" class="rounded-circle mb-1">
      {% else %}
        <img src="{% static 'img/logo.png' %}" alt="Аватар" width="40" height="40" class="rounded-circle mb-1">
      {% endif %}

      <!-- Блок оценки -->
      <div class="vote">
        {% if user.is_authenticated %}
          <button type="button" class="vote-button up like-btn" data-answer-id="{{ a.id }}" data-type="like" aria-label="Голос за">▲</button>
        {% else %}
          <button type="button" class="vote-button up" disabled aria-label="Голос за">▲</button>
        {% endif %}

        <div class="vote-count" id="score-answer-{{ a.id }}">{{ a.score }}</div>

        {% if user.is_authenticated %}
          <button type="button" class="vote-button down dislike-btn" data-answer-id="{{ a.id }}" data-type="dislike" aria-label="Голос против">▼</button>
        {% else %}
          <button type="button" class="vote-button down" disabled aria-label="Голос против">▼</button>
        {% endif %}
      </div>

      <!-- Кнопка отметки правильного ответа -->
      {% if question.author == user %}
        {% if not a.is_accepted %}
          {% if not has_accepted_answer %}
            <button type="button" class="btn btn-outline-primary btn-sm mark-correct-btn mt-2" data-answer-id="{{ a.id }}" style="width: 100%; font-size: 0.8rem; padding: 0.25rem 0.5rem;">
              Отметить как правильный
            </button>
          {% endif %}
        {% else %}
          <button type="button" class="btn btn-success btn-sm unmark-correct-btn mt-2" data-answer-id="{{ a.id }}" style="width: 100%; font-size: 0.8rem; padding: 0.25rem 0.5rem;">
            Правильный ответ
          </button>
        {% endif %}
      {% endif %}
    </div>

    <!-- Правый блок: текст ответа -->
    <div class="flex-grow-1">
      <div class="d-flex align-items-center gap-2 mb-1">
        <span class="small text-muted">от {{ a.author }} • {{ a.created }}</span>
        {% if a.is_accepted %}
          <span class="ms-2 badge bg-success">Правильный ответ</span>
        {% endif %}
      </div>
      <div>{{ a.text }}</div>
    </div>
  </div>
</article>